# –û—Ç—á–µ—Ç –æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ –∫–æ–¥–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Planfix API –∏ Webhook

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-01-29  
**–ò—Å—Ç–æ—á–Ω–∏–∫–∏:** `swagger.json`, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Planfix, —Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

## –†–µ–∑—é–º–µ

–ü—Ä–æ–≤–µ–¥–µ–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Planfix API (swagger.json) –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ webhook. –ù–∞–π–¥–µ–Ω–æ **15 –ø—Ä–æ–±–ª–µ–º**, —Ç—Ä–µ–±—É—é—â–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 1. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ `processId` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏

**–§–∞–π–ª:** `planfix_api.py:707-709`

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `processId` –∫–∞–∫ —á–∏—Å–ª–æ –Ω–∞–ø—Ä—è–º—É—é:
```python
if process_id:
    task_data["processId"] = int(process_id)
```

**–°–æ–≥–ª–∞—Å–Ω–æ swagger.json:** `processId` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º (integer), —á—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –ù–û –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç `process: {"id": ...}`.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–∞—à Planfix. –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç, –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞:
```python
if process_id:
    task_data["process"] = {"id": int(process_id)}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π (–º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–∞–º —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á)

---

### 2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `counterparty` –≤ webhook

**–§–∞–π–ª:** `webhook_server.py:194`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `project_id`, –Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `counterparty`:
```python
project_id_raw = task.get('project', {}).get('id')
if not task_id_raw or not project_id_raw:
    logger.warning(f"Incomplete task data in webhook: {data}")
    return
```

**–°–æ–≥–ª–∞—Å–Ω–æ swagger.json:** `counterparty` –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º `{"id": 5}` –∏–ª–∏ —Å—Ç—Ä–æ–∫–æ–π `"contact:5"`.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é `counterparty`:
```python
counterparty_raw = task.get('counterparty', {})
if isinstance(counterparty_raw, dict):
    counterparty_id = counterparty_raw.get('id')
elif isinstance(counterparty_raw, str):
    counterparty_id = counterparty_raw.split(':')[-1] if ':' in counterparty_raw else counterparty_raw
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π (–º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö –æ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–µ)

---

### 3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ webhook

**–§–∞–π–ª:** `webhook_server.py:911-1142`

**–ü—Ä–æ–±–ª–µ–º–∞:** Webhook handler –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å –∑–∞–ø—Ä–æ—Å–∞ –æ—Ç Planfix.

**–°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Planfix:** Webhook –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è –Ω–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ –ø–æ–¥–ø–∏—Å—å –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö –∏–ª–∏ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏:
```python
async def webhook_handler(request):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ (–µ—Å–ª–∏ Planfix –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç)
    signature = request.headers.get('X-Planfix-Signature')
    if signature:
        # –í—ã—á–∏—Å–ª–∏—Ç—å –æ–∂–∏–¥–∞–µ–º—É—é –ø–æ–¥–ø–∏—Å—å –∏ —Å—Ä–∞–≤–Ω–∏—Ç—å
        expected_signature = compute_signature(request.body, SECRET_KEY)
        if signature != expected_signature:
            logger.warning("Invalid webhook signature")
            return web.Response(text='Invalid signature', status=401)
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

---

## üü° –°–ï–†–¨–ï–ó–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### 4. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è `assignees.users` –≤ webhook

**–§–∞–π–ª:** `webhook_server.py:288-305`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–¥ –ø—ã—Ç–∞–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–∞—Å—Å–∏–≤—ã –≤ `assignees.users`, –Ω–æ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç, —á—Ç–æ Planfix –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å ID –≤ —Ñ–æ—Ä–º–∞—Ç–µ `"user:123"` –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ `123`.

**–°–æ–≥–ª–∞—Å–Ω–æ swagger.json:** –í –æ—Ç–≤–µ—Ç–∞—Ö API `assignees.users` —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±—ä–µ–∫—Ç—ã –≤–∏–¥–∞:
```json
{
  "users": [
    {"id": "user:5", "name": "–ò–≤–∞–Ω"},
    {"id": "contact:1", "name": "–ü–µ—Ç—Ä"}
  ]
}
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–ª—É—á—à–∏—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é:
```python
assignee_users = []
if isinstance(assignee_users_raw, list):
    for user in assignee_users_raw:
        if isinstance(user, dict):
            user_id = user.get('id')
            # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º ID: "user:123" -> 123, "contact:456" -> "contact:456"
            if isinstance(user_id, str) and ':' in user_id:
                prefix, uid = user_id.split(':', 1)
                if prefix == 'user':
                    user['normalized_id'] = int(uid) if uid.isdigit() else uid
                else:
                    user['normalized_id'] = user_id  # –°–æ—Ö—Ä–∞–Ω—è–µ–º contact:ID –∫–∞–∫ –µ—Å—Ç—å
            elif isinstance(user_id, (int, str)):
                user['normalized_id'] = int(user_id) if str(user_id).isdigit() else user_id
            assignee_users.append(user)
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π (–º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π)

---

### 5. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `status` –≤ webhook

**–§–∞–π–ª:** `webhook_server.py:228-234, 271-283`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–¥ –ø—ã—Ç–∞–µ—Ç—Å—è –∏–∑–≤–ª–µ—á—å —Å—Ç–∞—Ç—É—Å –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –º–µ—Å—Ç, –≤–∫–ª—é—á–∞—è –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ–ª—è —Ç–∏–ø–∞ `task.status.–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä`.

**–°–æ–≥–ª–∞—Å–Ω–æ swagger.json:** –°—Ç–∞—Ç—É—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º:
```json
{
  "status": {
    "id": 4,
    "name": "–í —Ä–∞–±–æ—Ç–µ"
  }
}
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–ø—Ä–æ—Å—Ç–∏—Ç—å –ª–æ–≥–∏–∫—É, –∏—Å–ø–æ–ª—å–∑—É—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ–ª—è:
```python
status_obj = task.get('status', {})
if isinstance(status_obj, dict):
    status_id = status_obj.get('id')
    status_name = status_obj.get('name')
    # –ï—Å–ª–∏ id - —Å—Ç—Ä–æ–∫–∞, –ø—ã—Ç–∞–µ–º—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å
    if isinstance(status_id, str):
        if ':' in status_id:
            status_id = int(status_id.split(':')[-1])
        else:
            status_id = int(status_id) if status_id.isdigit() else None
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π (–º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å—Ç–∞—Ç—É—Å–æ–≤)

---

### 6. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ `generalId` –≤ webhook

**–§–∞–π–ª:** `webhook_server.py:315-320`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–¥ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `generalId`, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

**–°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Planfix:** `generalId` - —ç—Ç–æ –ø—É–±–ª–∏—á–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ `id`.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `generalId` –∫–∞–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è –ø–æ–∏—Å–∫–∞ –∑–∞–¥–∞—á:
```python
# –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: generalId > id
task_identifier = task.get('generalId') or task.get('id')
if isinstance(task_identifier, str):
    try:
        task_identifier = int(task_identifier)
    except ValueError:
        pass
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–∏–∑–∫–∏–π (—É–ª—É—á—à–µ–Ω–∏–µ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏)

---

### 7. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `files` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏

**–§–∞–π–ª:** `planfix_api.py:713-733`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–¥ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç `files` –∫–∞–∫ –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ `{"id": f_id}`, —á—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

**–°–æ–≥–ª–∞—Å–Ω–æ swagger.json:** –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è:
```json
{
  "files": [
    {"id": 10},
    {"id": 15}
  ]
}
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∑–∞–¥–∞—á–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–∏–∑–∫–∏–π (—É–ª—É—á—à–µ–Ω–∏–µ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏)

---

### 8. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `customFieldData` –≤ webhook

**–§–∞–π–ª:** `webhook_server.py:753-785`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–¥ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `customFieldData`, –Ω–æ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Ç–∏–ø—ã –ø–æ–ª–µ–π —Å–æ–≥–ª–∞—Å–Ω–æ swagger.json.

**–°–æ–≥–ª–∞—Å–Ω–æ swagger.json:** `customFieldData` –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–æ–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ (Line, Number, Date, Time, Checkbox, List, Directory entry, Contact, Employee, Counterparty, –∏ —Ç.–¥.).

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –ø–æ–ª–µ–π –∏–ª–∏ —Ö–æ—Ç—è –±—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤:
```python
for field_data in custom_fields:
    field_obj = field_data.get('field', {})
    field_type = field_obj.get('type')
    field_value = field_data.get('value')
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
    if field_type == 0:  # Line
        # –°—Ç—Ä–æ–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        pass
    elif field_type == 1:  # Number
        # –ß–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        pass
    # ... –∏ —Ç.–¥.
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–∏–∑–∫–∏–π (—É–ª—É—á—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö)

---

## üü¢ –°–†–ï–î–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 9. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ç–µ–ª–∞ webhook

**–§–∞–π–ª:** `webhook_server.py:915`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–¥ —á–∏—Ç–∞–µ—Ç –≤—Å–µ —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞:
```python
raw_body = await request.read()
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:
```python
MAX_WEBHOOK_BODY_SIZE = 10 * 1024 * 1024  # 10 MB
raw_body = await request.read()
if len(raw_body) > MAX_WEBHOOK_BODY_SIZE:
    logger.warning(f"Webhook body too large: {len(raw_body)} bytes")
    return web.Response(text='Payload too large', status=413)
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

---

### 10. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `comment.json` –≤ webhook

**–§–∞–π–ª:** `webhook_server.py:966-1035`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–¥ –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ JSON-–æ–±—ä–µ–∫—Ç—ã –≤ —Å—Ç—Ä–æ–∫–∞—Ö, —á—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ–±–ª–µ–º—É —Å —Ñ–æ—Ä–º–∞—Ç–æ–º –¥–∞–Ω–Ω—ã—Ö –æ—Ç Planfix.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–ø—Ä–æ—Å—Ç–∏—Ç—å –ª–æ–≥–∏–∫—É –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É Planfix –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ webhook.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–∏–∑–∫–∏–π (—Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ —Å–ª–æ–∂–Ω–æ)

---

### 11. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ `task.reminder` —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

**–§–∞–π–ª:** `webhook_server.py:826-896`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–¥ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `task.reminder`, –Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–∂–µ—Ç –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º –æ—Ç Planfix.

**–°–æ–≥–ª–∞—Å–Ω–æ PLANFIX_REMINDER_WEBHOOK_EXAMPLE.json:** Webhook –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ `task.id`:
```json
{
  "event": "task.reminder",
  "task": {
    "id": "{{–ó–∞–¥–∞—á–∞.–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä}}"
  }
}
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ –≤ webhook —Ç–æ–ª—å–∫–æ `id`:
```python
async def handle_task_reminder(self, data: dict):
    task = data.get('task', {})
    task_id_raw = task.get('id')
    
    if not task_id_raw:
        logger.warning(f"Incomplete task data in reminder webhook: {data}")
        return
    
    # –ï—Å–ª–∏ –≤ webhook —Ç–æ–ª—å–∫–æ id, –ø–æ–ª—É—á–∞–µ–º –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ API
    if not task.get('status') or not task.get('assignees'):
        full_task = await planfix_client.get_task_by_id(
            task_id,
            fields="id,status,assignees,process"
        )
        if full_task and full_task.get('result') == 'success':
            task = full_task.get('task', {})
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–∏–∑–∫–∏–π (—É–ª—É—á—à–µ–Ω–∏–µ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏)

---

### 12. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `operator` –≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ö

**–§–∞–π–ª:** `planfix_api.py:499, planfix_sync.py:276`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç—Ä–æ–∫—É `"equal"` –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞, —á—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ–≥–ª–∞—Å–Ω–æ swagger.json.

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º

---

### 13. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `contact.id` –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö

**–§–∞–π–ª:** `planfix_api.py:520-527, webhook_server.py:153-165`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–¥ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç `contact.id` –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞ `"contact:123"` –≤ —á–∏—Å–ª–æ, —á—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º

---

### 14. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `assignees` –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏

**–§–∞–π–ª:** `planfix_api.py:859-890`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–¥ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç `assignees` –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ–≥–ª–∞—Å–Ω–æ swagger.json:
```python
assignees_payload = {
    "users": [{"id": f"user:{int(user_id)}"} for user_id in assignee_users],
    "groups": [{"id": int(group_id)} for group_id in assignee_groups]
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º

---

### 15. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ `sourceObjectId` –∏ `sourceDataVersion`

**–§–∞–π–ª:** `planfix_api.py:684-769`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–¥ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `sourceObjectId` –∏ `sourceDataVersion` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á, —Ö–æ—Ç—è —ç—Ç–∏ –ø–æ–ª—è –µ—Å—Ç—å –≤ swagger.json.

**–°–æ–≥–ª–∞—Å–Ω–æ swagger.json:** –≠—Ç–∏ –ø–æ–ª—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
```python
if source_object_id:
    task_data["sourceObjectId"] = source_object_id
if source_data_version:
    task_data["sourceDataVersion"] = source_data_version
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–∏–∑–∫–∏–π (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

---

## üìã –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ü–†–ò–û–†–ò–¢–ï–¢–ê–ú

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ):
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç `processId` (1)
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏ webhook (3)
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞ (9)

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è):
4. ‚úÖ –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É `counterparty` –≤ webhook (2)
5. ‚úÖ –£–ª—É—á—à–∏—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é `assignees.users` (4)
6. ‚úÖ –£–ø—Ä–æ—Å—Ç–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É `status` –≤ webhook (5)

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—É–ª—É—á—à–µ–Ω–∏—è):
7. ‚úÖ –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É `generalId` (6)
8. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ñ–∞–π–ª–æ–≤ (7)
9. ‚úÖ –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É `customFieldData` (8)
10. ‚úÖ –£–ø—Ä–æ—Å—Ç–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É `comment.json` (10)
11. ‚úÖ –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É `task.reminder` (11)
12. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É `sourceObjectId` (15)

---

## ‚úÖ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û

1. ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `assignees` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á
2. ‚úÖ –§–æ—Ä–º–∞—Ç `counterparty` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á
3. ‚úÖ –§–æ—Ä–º–∞—Ç `status` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á
4. ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `files` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á
5. ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è `contact.id`
6. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `operator` –≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ö
7. ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `customFieldData` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á

---

## üìù –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–ö–æ–¥ –≤ —Ü–µ–ª–æ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Planfix API, –Ω–æ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é (–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ webhook) –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –¥–∞–Ω–Ω—ã—Ö –≤ webhook. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –≤—ã—Å–æ–∫–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å.

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** 85% ‚úÖ

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:** 3  
**–°–µ—Ä—å–µ–∑–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:** 5  
**–°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:** 7

